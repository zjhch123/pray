!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).pray={})}(this,function(e){"use strict";var o=function(e){return Object.prototype.toString.call(e)},a=function(e){return"[object String]"===o(e)||"[object Number]"===o(e)},P=function(e){return null!=e},u=window.eventCache=new Map,r=/^on(\w+)$/;function i(e){return r.test(e)}function c(e,t,n){i(t)&&function(e,t,n){if(u.has(e)){var r=u.get(e),i=r.filter(function(e){return e.eventName===t});0<i.length&&s(e,t),u.get(e).push({eventName:t,eventListener:n})}else u.set(e,[{eventName:t,eventListener:n}]);e.addEventListener(t,n)}(e,t.match(r)[1].toLowerCase(),n)}function s(t,n){if(u.has(t))if(void 0===n)u.get(t).forEach(function(e){t.removeEventListener(e.eventName,e.eventListener)});else{u.get(t).filter(function(e){return e.eventName===n}).forEach(function(e){t.removeEventListener(n,e.eventListener)});var e=u.get(t).filter(function(e){return e.eventName!==n});u.set(t,e)}}function f(e,t,n){if(i(t))c(e,t,n);else switch(t){case"style":e.style.cssText=n;break;case"value":if("input"===e.tagName||"textarea"===e.tagName){e.value=n;break}e.setAttribute("value",n);break;case"className":e.setAttribute("class",n);break;case"key":e.setAttribute("data-pray-id",n);break;default:e.setAttribute(t,n)}}var l={each:function(e,t){for(var n=0;n<e.length&&!t(n,e[n],e);n++);},flatArr:function(e){var n=this;return e.reduce(function(e,t){return e.concat(Array.isArray(t)?n.flatArr(t):t)},[])}},t=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var v=function(){function o(e,t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.type=e,this.props=null===t?{}:t,this.children=n||[],this.count=0,this.key=this.props.key,l.each(this.children,function(e,t){t instanceof o?r.count+=t.count:r.children[e]=""+t,r.count+=1})}return t(o,[{key:"render",value:function(){var e=document.createElement(this.type),t=this.props;for(var n in t){f(e,n,t[n])}for(var r=0;r<this.children.length;r++){var i=this.children[r];e.appendChild(i instanceof o?i.render():document.createTextNode(i))}return e}},{key:"compare",value:function(e){return e instanceof o&&(e.type===this.type&&e.key===this.key)}},{key:"original",value:function(){return new o(this.type,this.props,this.children)}}]),o}();var h=[];var d=window.state=new Map,p=null;function y(t){return d.has(t)||d.set(t,{cursor:0,isFirst:!0,state:[],eventHandler:[]}),function(e){return function(i){var o=this,a=d.get(i);return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];p=i,a.cursor=0;var r=i.apply(o,t);return a.cursor=0,a.isFirst=!1,p=null,r}}(t)(e)}}function m(e,t){!function e(t,n,r){var i=n[r.index];var o=t.childNodes?t.childNodes.length:0;for(var a=0;a<o;a++){var u=t.childNodes[a];r.index+=1,e(u,n,r)}i&&(c=t,l.each(i,function(e,t){switch(t.type){case g.REORDER:u=c,l.each(t.moves,function(e,t){var n=t.index;switch(t.type){case 0:s(u.childNodes[n]),u.removeChild(u.childNodes[n]);break;case 1:var r="string"==typeof t.item?document.createTextNode(t.item):t.item.render();u.insertBefore(r,u.childNodes[n]||null);break;case 2:var i=t.from,o=t.to,a=u.childNodes;u.insertBefore(a[i],a[o]),u.insertBefore(a[o],a[i])}});break;case g.REPLACE:s(c);var n="string"==typeof t.item?document.createTextNode(t.item):t.item.render();c.parentNode.replaceChild(n,c);break;case g.TEXT:c.textContent?c.textContent=t.item:c.nodeValue=t.item;break;case g.PROPS:!function(e,t){for(var n in t)void 0===t[n]?e.removeAttribute(n):f(e,n,t[n])}(c,t.item)}var u}));var c}(e,t,{index:0})}var g={REPLACE:Symbol("replace"),TEXT:Symbol("text"),PROPS:Symbol("props"),REORDER:Symbol("reorder")};function R(e,t){if(P(e)&&P(t))return"string"==typeof t?e[t]:t(e)}function C(e){for(var t,n,r,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"id",o={},a=[],u=0;u<e.length;u++){var c=e[u],s=R(c,i);P(s)?o[s]=u:a.push(c)}return(n="noKeyItem")in(t={keyIndex:o,noKeyItem:r=a})?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function b(e,t){var n={};return E(e,t,0,n),n}function E(e,t,n,r){var i=[];null===t||(a(e)&&a(t)?e!=t&&i.push({type:g.TEXT,item:t}):e instanceof v&&t instanceof v?e.compare(t)?(function(e,t,n){var r={},i=0;for(var o in e)e[o]!==t[o]&&(r[o]=t[o],i+=1);for(var a in t)e.hasOwnProperty(a)||(r[a]=t[a],i+=1);0<i&&n.push({type:g.PROPS,item:r})}(e.props,t.props,i),function(e,r,t,n,i){var o=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"id",r=C(t,n),i=r.keyIndex,o=r.noKeyItem,a=[],u=[],c=0,s=0;for(s=0;s<e.length;s++){var f=R(e[s],n);P(f)?i.hasOwnProperty(f)?u.push(t[i[f]]):u.push(null):u.push(o[c++]||null)}var l=u.slice(0);for(s=0;s<l.length;)null===l[s]?(N(s),w(s)):s+=1;for(var v=s=0,h=0,d=C(l,n).keyIndex;v<t.length;){var p=t[v],y=R(p,n),m=l[s],g=R(m,n);if(P(m))if(g===y)s+=1;else if(d.hasOwnProperty(y)){var b=d[y];a.push({type:2,from:s+h,to:b+h}),A(s,b,g,y),s+=1}else x(v,p),h+=1;else x(v,p),h+=1;v+=1}for(var E=l.length-s,k=0;k<E;k++)N(v),w(v);function w(e){l.splice(e,1)}function N(e){a.push({type:0,index:e})}function x(e,t){a.push({type:1,index:e,item:t})}function A(e,t,n,r){var i=[l[t],l[e]];l[e]=i[0],l[t]=i[1];var o=[d[r],d[n]];d[n]=o[0],d[r]=o[1]}return{moves:a,children:u}}(e,r,"key"),a=o.moves,u=o.children;0!==a.length&&n.push({type:g.REORDER,moves:a});var c=null,s=t;r=u,l.each(e,function(e,t){var n=r[e];s=c&&c.count?c.count+s+1:s+1,E(c=t,n,s,i)})}(e.children,t.children,n,i,r)):i.push({type:g.REPLACE,index:n,item:t}):i.push({type:g.REPLACE,item:t})),0<i.length&&(r[n]=i)}e.useState=function(e){if(null===p)throw Error("Component get null in `useState`");var t=d.get(p),n=[(i=t,o=e,i.isFirst?i.state[i.cursor]=o:i.state[i.cursor]),(r=t,r.isFirst&&(r.eventHandler[r.cursor]=function(e){r.state[r.cursor]=e,h.forEach(function(e){e()})}),r.eventHandler[r.cursor])];var r;var i,o;return t.cursor+=1,n},e.element=function(e,t){for(var n=arguments.length,r=Array(2<n?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return"[object Function]"===o(e)?function e(t,n){var r=y(t)(n);return r.original=function(){return e(t,n)},r}(e,t):function(e,t){for(var n=arguments.length,r=Array(2<n?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return new v(e,t,l.flatArr(r))}(e,t,r)},e.render=function(n,e){if(n instanceof v){var r=n.render();return e.appendChild(r),void h.push(function(){var e=n.original(),t=b(n,e);console.log(t),m(r,t),n=e})}throw Error("render method need a VNode element but received "+n+" !")},e.diff=b,e.patch=m,Object.defineProperty(e,"__esModule",{value:!0})});
